<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Necesse Game - Gameplay</title>
    <style>
        body { margin: 0; background: #3e5d39; overflow: hidden; color: white; font-family: sans-serif; }
        canvas { display: block; image-rendering: pixelated; }
        .ui { position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.6); padding: 15px; border: 2px solid #8b4513; }
    </style>
</head>
<body>
    <div class="ui">
        <div id="nameDisplay">NHÂN VẬT: ...</div>
        <p>Di chuyển: WASD / Mũi tên</p>
        <a href="index.html" style="color: #ffcc00; font-weight: bold;">[ THOÁT RA SẢNH ]</a>
    </div>
    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // Lấy tên từ sảnh
        document.getElementById('nameDisplay').innerText = "NHÂN VẬT: " + (localStorage.getItem('charName') || "HoangKun");

        // 1. NẠP ẢNH - BẠN PHẢI ĐẶT TÊN FILE ĐÚNG NHƯ TRÊN GITHUB
        const imgPlayer = new Image();
        imgPlayer.src = 'nhan-vat.png'; // Thay bằng tên file ảnh nhân vật bạn đã up

        const imgGrass = new Image();
        imgGrass.src = 'co.png'; // Thay bằng tên file ảnh cỏ bạn đã up (Isometric)

        const imgTree = new Image();
        imgTree.src = 'cay.png'; // Thay bằng tên file ảnh cây bạn đã up

        let p = { x: canvas.width/2, y: canvas.height/2, speed: 4, frameX: 0, frameY: 0 };
        let keys = {};

        window.onkeydown = (e) => keys[e.code] = true;
        window.onkeyup = (e) => keys[e.code] = false;

        function update() {
            if (keys['ArrowUp'] || keys['KeyW']) { p.y -= p.speed; p.frameY = 1; }
            if (keys['ArrowDown'] || keys['KeyS']) { p.y += p.speed; p.frameY = 0; }
            if (keys['ArrowLeft'] || keys['KeyA']) { p.x -= p.speed; p.frameY = 2; }
            if (keys['ArrowRight'] || keys['KeyD']) { p.x += p.speed; p.frameY = 3; }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Vẽ nền cỏ lặp lại (theo kiểu ô gạch)
            if (imgGrass.complete) {
                for(let x=0; x<canvas.width; x+=128) {
                    for(let y=0; y<canvas.height; y+=128) {
                        ctx.drawImage(imgGrass, x, y, 128, 128);
                    }
                }
            }

            // Vẽ cây trang trí
            if (imgTree.complete) {
                ctx.drawImage(imgTree, 200, 150, 150, 150);
            }

            // Vẽ nhân vật (Cắt khung hình 48x48 từ spritesheet của bạn)
            if (imgPlayer.complete) {
                // p.frameY điều khiển hướng nhìn (Xuống, Lên, Trái, Phải)
                ctx.drawImage(imgPlayer, p.frameX * 48, p.frameY * 48, 48, 48, p.x, p.y, 80, 80);
            }

            update();
            requestAnimationFrame(draw);
        }

        draw();
    </script>
</body>
</html>
