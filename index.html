<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HoangKun - Online Multiplayer</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { margin: 0; background: #050505; color: white; font-family: sans-serif; text-align: center; overflow: hidden; }
        #game-container { position: relative; width: 100vw; height: 80vh; background: #111; border-bottom: 2px solid #00f2fe; }
        .player { position: absolute; width: 20px; height: 20px; transition: all 0.1s linear; border-radius: 4px; }
        .player-label { position: absolute; top: -20px; left: -10px; font-size: 10px; width: 50px; }
        .controls { padding: 20px; display: flex; justify-content: center; gap: 10px; }
        .btn { padding: 15px 25px; background: #333; color: white; border: none; border-radius: 10px; font-weight: bold; }
    </style>
</head>
<body>

    <h2>MULTIPLAVER NEON WORLD üåç</h2>
    <p id="status">ƒêang k·∫øt n·ªëi server...</p>

    <div id="game-container"></div>

    <div class="controls">
        <button class="btn" onclick="move('up')">UP</button>
        <button class="btn" onclick="move('left')">LEFT</button>
        <button class="btn" onclick="move('down')">DOWN</button>
        <button class="btn" onclick="move('right')">RIGHT</button>
    </div>

<script>
    // --- THAY TH·∫æ C·∫§U H√åNH FIREBASE C·ª¶A B·∫†N V√ÄO ƒê√ÇY ---
    const firebaseConfig = {
        apiKey: "AIzaSy...",
        authDomain: "your-project.firebaseapp.com",
        databaseURL: "https://your-project-default-rtdb.firebaseio.com",
        projectId: "your-project",
        storageBucket: "your-project.appspot.com",
        messagingSenderId: "...",
        appId: "..."
    };
    // --------------------------------------------------

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const playersRef = db.ref("players");

    let myId;
    let myData = {
        x: Math.floor(Math.random() * 200) + 50,
        y: Math.floor(Math.random() * 200) + 50,
        color: `hsl(${Math.random() * 360}, 70%, 60%)`,
        name: "Player_" + Math.floor(Math.random() * 1000)
    };

    // T·∫°o ID cho ng∆∞·ªùi ch∆°i hi·ªán t·∫°i
    const newPlayerRef = playersRef.push();
    myId = newPlayerRef.key;
    document.getElementById("status").innerText = "B·∫°n l√†: " + myData.name;

    // C·∫≠p nh·∫≠t v·ªã tr√≠ l√™n Firebase
    newPlayerRef.set(myData);

    // Khi ng·∫Øt k·∫øt n·ªëi, x√≥a ng∆∞·ªùi ch∆°i n√†y
    newPlayerRef.onDisconnect().remove();

    // L·∫Øng nghe d·ªØ li·ªáu t·ª´ nh·ªØng ng∆∞·ªùi ch∆°i kh√°c
    playersRef.on("value", (snapshot) => {
        const players = snapshot.val() || {};
        const container = document.getElementById("game-container");
        container.innerHTML = ""; // V·∫Ω l·∫°i to√†n b·ªô th·∫ø gi·ªõi

        Object.keys(players).forEach(id => {
            const p = players[id];
            const div = document.createElement("div");
            div.className = "player";
            div.style.left = p.x + "px";
            div.style.top = p.y + "px";
            div.style.background = p.color;
            div.style.boxShadow = `0 0 10px ${p.color}`;
            
            const label = document.createElement("div");
            label.className = "player-label";
            label.innerText = p.name + (id === myId ? " (B·∫°n)" : "");
            div.appendChild(label);
            
            container.appendChild(div);
        });
    });

    // H√†m di chuy·ªÉn
    function move(dir) {
        const step = 15;
        if(dir === 'up') myData.y -= step;
        if(dir === 'down') myData.y += step;
        if(dir === 'left') myData.x -= step;
        if(dir === 'right') myData.x += step;

        // Gi·ªõi h·∫°n bi√™n m√†n h√¨nh
        myData.x = Math.max(0, Math.min(window.innerWidth - 20, myData.x));
        myData.y = Math.max(0, Math.min(window.innerHeight * 0.8 - 20, myData.y));

        newPlayerRef.update(myData);
    }

    // ƒêi·ªÅu khi·ªÉn b·∫±ng ph√≠m m≈©i t√™n
    window.addEventListener("keydown", (e) => {
        if(e.key === "ArrowUp") move('up');
        if(e.key === "ArrowDown") move('down');
        if(e.key === "ArrowLeft") move('left');
        if(e.key === "ArrowRight") move('right');
    });
</script>
</body>
</html>
