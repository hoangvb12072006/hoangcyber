<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Necesse Mini By HoangKun</title>
<style>
body{margin:0;overflow:hidden;background:#000;font-family:monospace}
button{
  font-size:20px;
  padding:10px 20px;
  background:#8d6e63;
  color:#fff;
  border:3px solid #3d251e;
}
#menu,#pause,#craft{
  position:fixed;inset:0;
  background:rgba(0,0,0,.8);
  display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  gap:15px;z-index:10;
}
canvas{display:none}
</style>
</head>

<body ontouchstart="">

<div id="menu">
  <h1 style="color:#fff">NECESSE MINI</h1>
  <button onclick="startGame()">START GAME</button>
</div>

<div id="pause" style="display:none">
  <h2 style="color:white">PAUSE</h2>
  <button onclick="resume()">TIẾP TỤC</button>
  <button onclick="backMenu()">VỀ SẢNH</button>
</div>

<div id="craft" style="display:none">
  <h2 style="color:white">CRAFT</h2>
  <button onclick="craftSword()">Kiếm (5 Gỗ)</button>
  <button onclick="closeCraft()">ĐÓNG</button>
</div>

<canvas id="game"></canvas>

<script>
/* ====== CORE ====== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

/* ====== GAME STATE ====== */
let running=false, paused=false;
let keys={};

/* ====== PLAYER ====== */
const player={
  x:1000,y:1000,
  size:32,speed:3,
  frame:0,dir:0,
  hasSword:false,
  hp:100
};

/* ====== WORLD ====== */
const trees=[];
const slimes=[];
for(let i=0;i<50;i++){
  trees.push({x:Math.random()*2000,y:Math.random()*2000,hp:3});
}
for(let i=0;i<10;i++){
  slimes.push({x:Math.random()*2000,y:Math.random()*2000,hp:3});
}

/* ====== INVENTORY ====== */
const inv={wood:0};

/* ====== CONTROLS ====== */
addEventListener("keydown",e=>{
  keys[e.code]=true;
  if(e.code==="Escape") togglePause();
});
addEventListener("keyup",e=>keys[e.code]=false);

/* ====== MENU ====== */
function startGame(){
  document.getElementById("menu").style.display="none";
  canvas.style.display="block";
  running=true;
  loop();
}
function togglePause(){
  paused=!paused;
  document.getElementById("pause").style.display=paused?"flex":"none";
}
function resume(){ paused=false; document.getElementById("pause").style.display="none"; }
function backMenu(){ location.reload(); }

/* ====== CRAFT ====== */
function craftSword(){
  if(inv.wood>=5){
    inv.wood-=5;
    player.hasSword=true;
    alert("Đã chế tạo kiếm!");
  }
}
function closeCraft(){ document.getElementById("craft").style.display="none"; }

/* ====== ATTACK ====== */
addEventListener("click",attack);
function attack(){
  if(!running||paused) return;
  trees.forEach((t,i)=>{
    if(dist(player,t)<50){
      t.hp--;
      if(t.hp<=0){ trees.splice(i,1); inv.wood++; }
    }
  });
  slimes.forEach((s,i)=>{
    if(dist(player,s)<50){
      s.hp--;
      if(s.hp<=0) slimes.splice(i,1);
    }
  });
}

/* ====== LOOP ====== */
function loop(){
  if(!running) return;
  if(!paused){
    update();
    draw();
  }
  requestAnimationFrame(loop);
}

/* ====== UPDATE ====== */
function update(){
  let dx=0,dy=0;
  if(keys.KeyW)dy--;
  if(keys.KeyS)dy++;
  if(keys.KeyA)dx--;
  if(keys.KeyD)dx++;
  player.x+=dx*player.speed;
  player.y+=dy*player.speed;
  player.frame=(player.frame+1)%20;
}

/* ====== DRAW ====== */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const camX=player.x-canvas.width/2;
  const camY=player.y-canvas.height/2;

  // grass
  ctx.fillStyle="#2d6a4f";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // trees
  ctx.fillStyle="#3e2723";
  trees.forEach(t=>{
    ctx.fillRect(t.x-camX,t.y-camY,32,32);
  });

  // slimes
  ctx.fillStyle="#4caf50";
  slimes.forEach(s=>{
    ctx.fillRect(s.x-camX,s.y-camY,28,28);
  });

  // player (animation)
  ctx.fillStyle=player.hasSword?"#ffd54f":"#ff9800";
  ctx.fillRect(canvas.width/2,canvas.height/2,32,32);

  // HUD
  ctx.fillStyle="#fff";
  ctx.fillText("Gỗ: "+inv.wood,20,30);
  ctx.fillText("ESC: Pause | Click: Đánh | C: Craft",20,50);
}

/* ====== UTILS ====== */
function dist(a,b){
  return Math.hypot(a.x-b.x,a.y-b.y);
}
</script>
</body>
</html>